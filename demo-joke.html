<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>X402 Joke Demo</title>
    <style>
      :root {
        color-scheme: light dark;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #f8fafc;
        color: #0f172a;
      }
      body {
        margin: 40px auto;
        max-width: 640px;
        padding: 0 16px;
      }
      h1 {
        font-size: 1.8rem;
        margin-bottom: 0.25rem;
      }
      p {
        margin-top: 0;
        color: #475569;
      }
      button {
        appearance: none;
        border: none;
        background: #2563eb;
        color: #fff;
        border-radius: 8px;
        padding: 12px 20px;
        font-size: 1rem;
        cursor: pointer;
      }
      button:disabled {
        opacity: 0.6;
        cursor: progress;
      }
      pre {
        margin-top: 24px;
        padding: 16px;
        background: #0f172a;
        color: #e2e8f0;
        border-radius: 8px;
        overflow-x: auto;
        font-size: 0.95rem;
      }
      a {
        color: inherit;
      }
    </style>
  </head>
  <body>
    <h1>Random Joke (X402 Demo)</h1>
    <p>
      This page exercises the <code>https://fs9cqhm1.nx.link/random_joke</code> endpoint, which is protected by an
      X402 micropayment challenge. The current price is <strong>~$0.001 USDC</strong> per joke. With the autopay
      extension installed, click the button below and the extension should capture the 402 response, authorize the
      payment, and retry the request automatically.
    </p>

    <button id="fetch-joke">Fetch joke for $0.001 USDC</button>

    <pre id="output">Click the button to request a joke…</pre>

    <script>
      const output = document.getElementById("output");
      const button = document.getElementById("fetch-joke");

      async function fetchJoke() {
        button.disabled = true;
        output.textContent = "Requesting joke…";
        try {
          const response = await fetch("https://fs9cqhm1.nx.link/random_joke", {
            method: "GET",
            headers: {
              Accept: "application/json",
            },
          });

          if (!response.ok) {
            const text = await response.text();
            output.textContent = `HTTP ${response.status}\n\n${text}`;
            return;
          }

          const payload = await response.json();
          output.textContent = JSON.stringify(payload, null, 2);
        } catch (error) {
          output.textContent = `Request failed: ${error instanceof Error ? error.message : String(error)}`;
        } finally {
          button.disabled = false;
        }
      }

      button.addEventListener("click", () => {
        void fetchJoke();
      });
    </script>
  </body>
</html>
